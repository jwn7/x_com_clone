<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>X.com Clone - Home</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" th:href="@{/style.css}">

    <style>
        body {
            background-color: #000000;
            color: #E7E9EA;
            font-family: Arial, sans-serif;
        }
        .main-container {
            display: flex;
            justify-content: center;
            max-width: 1200px;
            margin: 0 auto;
        }
        .left-sidebar {
            width: 250px;
            padding: 20px;
        }
        .timeline {
            width: 600px;
            border-left: 1px solid #2F3336;
            border-right: 1px solid #2F3336;
            min-height: 100vh;
        }
        .right-sidebar {
            width: 350px;
            padding: 20px;
        }
        .header {
            padding: 15px;
            border-bottom: 1px solid #2F3336;
            font-size: 20px;
            font-weight: bold;
        }
        .action-button {
            background-color: #1DA1F2;
            color: white;
            padding: 10px 20px;
            border: none;
            border-radius: 9999px;
            font-weight: bold;
            display: block;
            text-align: center;
            margin-bottom: 10px;
            text-decoration: none;
        }
        .success-banner {
            background-color: #1DA1F2;
            color: white;
            padding: 10px;
            text-align: center;
            font-weight: bold;
        }
        .profile-image-large {
            width: 80px; /* ì™¼ìª½ ì‚¬ì´ë“œë°” í”„ë¡œí•„ ì´ë¯¸ì§€ */
            height: 80px;
            border-radius: 50%;
            object-fit: cover;
            border: 2px solid #000000;
        }
        .profile-image {
            width: 48px; /* íƒ€ì„ë¼ì¸ í¬ìŠ¤íŠ¸/ëŒ“ê¸€ í”„ë¡œí•„ ì´ë¯¸ì§€ */
            height: 48px;
            border-radius: 50%;
            object-fit: cover;
            margin-right: 10px;
        }
        .post-card {
            padding: 15px;
            border-bottom: 1px solid #2F3336;
        }
        .post-header-grid {
            display: grid;
            grid-template-columns: 48px 1fr;
            gap: 10px;
        }
        .post-info {
            font-size: 15px;
        }
        textarea {
            width: 100%;
            background: transparent;
            border: none;
            resize: none;
            color: #E7E9EA;
            font-size: 19px;
            padding: 10px 0;
            outline: none;
        }
    </style>
</head>
<body>

<div class="main-container">

    <div th:if="${signupSuccessMessage}" class="success-banner"
         style="position: fixed; top: 0; width: 50%; left: 50%; transform: translateX(-50%); z-index: 100;">
        <p th:text="${signupSuccessMessage}" style="margin: 0;"></p>
    </div>

    <div class="left-sidebar">
        <h2 class="text-3xl font-extrabold mb-6 text-white">X.com</h2>

        <div th:if="${currentUser == null}">
            <a th:href="@{/users/login}" class="action-button">ë¡œê·¸ì¸</a>
            <a th:href="@{/users/signup}" class="action-button" style="background-color: #000000; border: 1px solid #1DA1F2;">íšŒì›ê°€ì…</a>
        </div>

        <div th:if="${currentUser != null}">
            <a th:href="@{/users/profile/{username}(username=${currentUser.username})}"
               style="text-decoration: none; color: inherit; display: block;">
                <p class="text-lg font-bold">í™˜ì˜í•©ë‹ˆë‹¤, <span th:text="${currentUser.username}">User</span>ë‹˜!</p>
            </a>

            <a th:href="@{/users/profile/{username}(username=${currentUser.username})}"
               style="display: inline-block; margin-top: 5px; margin-bottom: 10px;">
                <img th:src="${currentUser.profileImageUrl ?: '/images/default-profile.png'}"
                     alt="Profile Image"
                     class="profile-image-large">
            </a>

            <a th:href="@{/users/profile/{username}(username=${currentUser.username})}"
               class="text-sm block hover:underline"
               style="color: #71767B; text-decoration: none; margin-bottom: 15px;">
                @<span th:text="${currentUser.username}"></span>
            </a>

            <a th:href="@{/users/logout}" class="action-button mt-4" style="background-color: #555;">ë¡œê·¸ì•„ì›ƒ</a>
        </div>
    </div>

    <div class="timeline">
        <div class="header">í™ˆ</div>

        <div th:if="${currentUser != null}" class="post-input-area"
             style="padding: 15px; border-bottom: 8px solid #2F3336;">

            <form id="postForm" onsubmit="createPost(event)" enctype="multipart/form-data">

                <div class="flex items-start">
                    <a th:href="@{/users/profile/{username}(username=${currentUser.username})}">
                        <img th:src="${currentUser.profileImageUrl ?: '/images/default-profile.png'}"
                             alt="Profile Image"
                             class="profile-image"
                             style="width: 48px; height: 48px; margin-top: 5px;">
                    </a>

                    <div style="flex-grow: 1;">
                        <textarea
                                id="postContent"
                                name="content"
                                rows="3"
                                placeholder="ë¬´ìŠ¨ ì¼ì´ ì¼ì–´ë‚˜ê³  ìˆë‚˜ìš”?"
                        ></textarea>

                        <input
                                id="postFiles"
                                type="file"
                                name="files"
                                multiple
                                style="margin-top: 10px; color: #E7E9EA;"
                        >
                    </div>
                </div>
                <div style="text-align: right; border-top: 1px solid #2F3336; padding-top: 10px; margin-top: 10px;">
                    <button id="postSubmitButton" type="submit"
                            style="background-color: #1DA1F2; color: white; padding: 8px 16px; border: none; border-radius: 9999px; font-weight: bold; cursor: pointer;">
                        ê²Œì‹œí•˜ê¸°
                    </button>
                </div>
            </form>
        </div>

        <div th:if="${posts.isEmpty()}" class="no-posts" style="padding: 20px; text-align: center; color: #71767B;">
            <p>ì•„ì§ ê²Œì‹œë¬¼ì´ ì—†ìŠµë‹ˆë‹¤.</p>
        </div>

        <div th:each="post : ${posts}" class="post-card"
             th:id="|post-${post.postId}|">

            <div class="post-header-grid">

                <a th:href="@{/users/profile/{username}(username=${post.user.username})}">
                    <img th:src="${post.user.profileImageUrl ?: '/images/default-profile.png'}"
                         alt="Profile Image"
                         class="profile-image">
                </a>

                <div style="min-width: 0;">

                    <div class="post-info flex items-center mb-1">
                        <a th:href="@{/users/profile/{username}(username=${post.user.username})}"
                           class="profile-link flex items-center hover:text-gray-200"
                           style="text-decoration: none; color: inherit;">
                            <span th:text="${post.user.username}" class="font-bold hover:underline">Display Name</span>
                            <span style="font-weight: normal; color: #71767B; margin-left: 5px;">
                                @<span th:text="${post.user.username}">Username</span>
                            </span>
                        </a>
                        <span style="color: #71767B; margin-left: 5px;">Â·</span>
                        <span th:text="${#temporals.format(post.createdAt, 'HH:mm')}"
                              style="color: #71767B; margin-left: 5px;">ì‹œê°„</span>
                    </div>

                    <div class="post-content" style="margin-top: 0;">
                        <p th:text="${post.content}">ì—¬ê¸°ì— í¬ìŠ¤íŠ¸ ë‚´ìš©ì´ ë“¤ì–´ê°‘ë‹ˆë‹¤.</p>
                    </div>

                    <div class="post-images" th:if="${post.mediaList != null and !post.mediaList.isEmpty()}">
                        <img th:each="media : ${post.mediaList}"
                             th:src="@{${media.fileUrl}}"
                             alt="ì²¨ë¶€ ì´ë¯¸ì§€"
                             style="max-width: 100%; border-radius: 10px; margin-top: 10px;">
                    </div>

                    <button
                            th:if="${currentUser != null and post.user.userId == currentUser.userId}"
                            th:data-post-id="${post.postId}"
                            onclick="deletePost(this.getAttribute('data-post-id'))"
                            style="background: transparent; color: #F4212E; border: none; cursor: pointer; font-size: 14px; margin-top: 10px;">
                        ì‚­ì œ
                    </button>

                </div>
            </div>
            <div style="margin-top: 10px; border-top: 1px solid #2F3336; padding-top: 10px; font-size: 14px; margin-left: 50px;"> <div style="display: flex; align-items: center; gap: 10px;">
                <form th:if="${currentUser != null}"
                      th:action="@{|/posts/${post.postId}/like|}"
                      method="post"
                      style="display: inline;">
                    <input type="hidden" name="userId"
                           th:value="${currentUser.userId}" />
                    <button type="submit"
                            style="background: transparent; border: none; color: #E7E9EA; cursor: pointer;">
                        â¤ï¸
                        <span th:text="${#lists.size(post.likes)}">0</span>
                    </button>
                </form>

                <span th:if="${currentUser == null}">
                        â¤ï¸ <span th:text="${#lists.size(post.likes)}">0</span>
                    </span>

                <span style="color: #71767B; margin-left: 10px;">
                        ğŸ’¬ <span th:text="${#lists.size(post.replies)}">0</span> ëŒ“ê¸€
                    </span>
            </div>

                <div style="margin-top: 8px; padding-left: 8px; border-left: 2px solid #2F3336;"
                     th:if="${post.replies != null and !post.replies.isEmpty()}">
                    <div th:each="reply : ${post.replies}" style="margin-bottom: 4px;">
                        <b th:text="${reply.user.username}">user</b>
                        <span style="color: #71767B; font-size: 12px; margin-left: 4px;"
                              th:text="${#temporals.format(reply.createdAt, 'MM-dd HH:mm')}">
                            11-24 13:20
                        </span>
                        <div th:text="${reply.content}" style="margin-left: 4px;"></div>
                    </div>
                </div>

                <form th:if="${currentUser != null}"
                      th:action="@{|/posts/${post.postId}/reply|}"
                      method="post"
                      style="margin-top: 8px; display: flex; gap: 6px;">

                    <input type="hidden" name="userId"
                           th:value="${currentUser.userId}" />

                    <input type="text"
                           name="content"
                           placeholder="ë‹µê¸€ì„ ë‚¨ê²¨ë³´ì„¸ìš”"
                           maxlength="280"
                           style="flex: 1; background: transparent; border: 1px solid #2F3336; border-radius: 9999px; padding: 6px 10px; color: #E7E9EA; font-size: 14px;" />

                    <button type="submit"
                            style="background-color: #1DA1F2; color: white; border: none; border-radius: 9999px; padding: 6px 12px; font-weight: bold; cursor: pointer;">
                        ë‹µê¸€
                    </button>
                </form>

                <div th:if="${currentUser == null}"
                     style="margin-top: 8px; color: #71767B; font-size: 12px;">
                    ëŒ“ê¸€ê³¼ ì¢‹ì•„ìš”ë¥¼ ë‚¨ê¸°ë ¤ë©´
                    <a th:href="@{/users/login}" style="color: #1DA1F2;">ë¡œê·¸ì¸</a> í•´ì£¼ì„¸ìš”.
                </div>
            </div>
        </div>
    </div>

    <div class="right-sidebar" style="width: 350px; padding: 10px;">
        <p style="color: #71767B;">íŠ¸ë Œë“œ ìœ„ì ¯ ì˜ì—­</p>
    </div>

</div>

<script th:src="@{/main.js}"></script>

</body>
</html>