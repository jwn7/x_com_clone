<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" class="dark">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title th:text="|${profileUser.username} (@${profileUser.username}) / X|">Profile - X</title>

    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

    <script>
        tailwind.config = {
            darkMode: 'class',
            theme: {
                extend: {
                    colors: {
                        primary: '#1D9BF0',
                        dark: '#000000',
                        darkHover: '#181818',
                        grayBorder: '#2F3336',
                        textMain: '#E7E9EA',
                        textSec: '#71767B',
                        like: '#F91880',
                        retweet: '#00BA7C'
                    }
                }
            }
        }
    </script>
    <style>
        body { background-color: black; color: #E7E9EA; font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif; }

        .profile-header-img {
            width: 100px;
            height: 100px;
            background-color: #333;
        }

        /* 탭 활성화 스타일 */
        .tab-active { color: #E7E9EA; border-bottom: 4px solid #1D9BF0; }
        .tab-inactive { color: #71767B; }
        .tab-inactive:hover { background-color: rgba(231, 233, 234, 0.1); }
    </style>
</head>
<body class="overflow-y-scroll">

<div class="flex justify-center min-h-screen">

    <header class="hidden sm:flex flex-col items-end pr-4 w-[80px] xl:w-[275px]">
        <div class="fixed top-0 h-full w-[80px] xl:w-[275px] py-2 px-2">
            <a th:href="@{/}" class="flex items-center justify-center xl:justify-start w-12 h-12 rounded-full hover:bg-darkHover transition mb-2 xl:pl-3">
                <i class="fa-brands fa-x-twitter text-3xl text-white"></i>
            </a>
            <nav class="space-y-1">
                <a th:href="@{/}" class="flex items-center gap-4 px-4 py-3 rounded-full hover:bg-darkHover transition w-fit">
                    <i class="fa-solid fa-house text-2xl"></i>
                    <span class="hidden xl:block text-xl font-bold">홈</span>
                </a>
                <a href="#" class="flex items-center gap-4 px-4 py-3 rounded-full hover:bg-darkHover transition w-fit">
                    <i class="fa-regular fa-user text-2xl"></i>
                    <span class="hidden xl:block text-xl font-bold">프로필</span>
                </a>
            </nav>
        </div>
    </header>

    <main class="w-full max-w-[600px] border-x border-grayBorder min-h-screen relative">

        <div class="sticky top-0 z-10 bg-black/80 backdrop-blur-md px-4 py-1 flex items-center gap-6 border-b border-grayBorder h-[53px]">
            <a th:href="@{/}" class="p-2 rounded-full hover:bg-white/10 transition cursor-pointer">
                <i class="fa-solid fa-arrow-left text-white"></i>
            </a>
            <div class="flex flex-col">
                <span class="font-bold text-lg leading-5" th:text="${profileUser.username}">Username</span>
                <span class="text-xs text-textSec" th:text="|${timelineItems.size()} posts|">0 posts</span>
            </div>
        </div>

        <div class="px-4 pt-6 pb-4 relative">

            <div class="flex justify-between items-center mb-4">
                <img th:src="${profileUser.profileImageUrl ?: '/images/default_profile.png'}"
                     class="rounded-full object-cover profile-header-img">

                <div>
                    <a th:if="${session.currentUser != null and session.currentUser.userId == profileUser.userId}"
                       th:href="@{/users/profile/edit}"
                       class="border border-grayBorder font-bold px-4 py-1.5 rounded-full hover:bg-white/10 transition text-sm">
                        프로필 수정
                    </a>

                    <div th:if="${session.currentUser != null and session.currentUser.userId != profileUser.userId}">
                        <form th:if="${!isFollowing}" th:action="@{'/users/profile/' + ${profileUser.username} + '/follow'}" method="post">
                            <button type="submit" class="bg-white text-black font-bold px-4 py-1.5 rounded-full hover:bg-gray-200 transition text-sm">
                                팔로우
                            </button>
                        </form>
                        <form th:if="${isFollowing}" th:action="@{'/users/profile/' + ${profileUser.username} + '/unfollow'}" method="post">
                            <button type="submit" class="border border-grayBorder text-white font-bold px-4 py-1.5 rounded-full hover:border-red-600 hover:text-red-600 hover:bg-red-600/10 transition text-sm group">
                                <span class="group-hover:hidden">팔로잉</span>
                                <span class="hidden group-hover:inline">언팔로우</span>
                            </button>
                        </form>
                    </div>
                </div>
            </div>

            <div class="mb-3">
                <h1 class="font-extrabold text-xl leading-6" th:text="${profileUser.username}">Display Name</h1>
                <div class="text-textSec text-[15px]">@<span th:text="${profileUser.username}">username</span></div>
            </div>

            <div class="mb-3 text-[15px] whitespace-pre-wrap">
                <span th:if="${profileUser.bio != null and profileUser.bio != ''}" th:text="${profileUser.bio}"></span>
                <span th:unless="${profileUser.bio != null and profileUser.bio != ''}" class="text-textSec">소개가 없습니다.</span>
            </div>

            <div class="flex items-center gap-4 text-textSec text-[15px] mb-3">
                <div class="flex items-center gap-1">
                    <i class="fa-regular fa-calendar-days"></i>
                    <span>가입일: <span th:text="${#temporals.format(profileUser.createdAt, 'yyyy년 M월')}">2023년 1월</span></span>
                </div>
            </div>

            <div class="flex gap-5 text-[14px]">
                <button type="button" onclick="openFollowModal('following')" class="hover:underline decoration-1 cursor-pointer">
                    <span class="font-bold text-white" th:text="${followingCount}">0</span>
                    <span class="text-textSec">팔로잉</span>
                </button>
                <button type="button" onclick="openFollowModal('followers')" class="hover:underline decoration-1 cursor-pointer">
                    <span class="font-bold text-white" th:text="${followerCount}">0</span>
                    <span class="text-textSec">팔로워</span>
                </button>
            </div>
        </div>

        <div class="flex border-b border-grayBorder mt-2">
            <div class="flex-1 text-center py-3 hover:bg-white/10 cursor-pointer font-bold text-white border-b-4 border-primary relative">
                게시물
            </div>
            <div class="flex-1 text-center py-3 hover:bg-white/10 cursor-pointer text-textSec font-medium">
                답글
            </div>
            <div class="flex-1 text-center py-3 hover:bg-white/10 cursor-pointer text-textSec font-medium">
                미디어
            </div>
            <div class="flex-1 text-center py-3 hover:bg-white/10 cursor-pointer text-textSec font-medium">
                마음에 들어요
            </div>
        </div>

        <div th:if="${timelineItems == null or timelineItems.isEmpty()}" class="p-8 text-center">
            <h3 class="font-bold text-2xl mb-2">아직 게시물이 없어요</h3>
            <p class="text-textSec text-sm">게시물을 작성하면 여기에 표시됩니다.</p>
        </div>

        <div th:each="item : ${timelineItems}" class="border-b border-grayBorder hover:bg-white/5 transition p-4 cursor-pointer relative"
             th:with="postContent=${item.originalPost}">

            <div th:if="${item.isRetweet}" class="text-textSec text-xs font-bold flex items-center gap-2 mb-1 ml-8">
                <i class="fa-solid fa-retweet"></i>
                <span th:text="${item.actionUser.username}">User</span>님이 리트윗했습니다
            </div>

            <div class="flex gap-3">
                <div class="flex-shrink-0">
                    <img th:src="${postContent.user.profileImageUrl ?: '/images/default_profile.png'}"
                         class="w-10 h-10 rounded-full object-cover bg-gray-700">
                </div>
                <div class="flex-1 min-w-0">
                    <div class="flex items-center gap-1 text-[15px]">
                        <a th:href="@{'/users/profile/' + ${postContent.user.username}}" class="font-bold hover:underline truncate text-white">
                            <span th:text="${postContent.user.username}">Display Name</span>
                        </a>
                        <span class="text-textSec truncate">@<span th:text="${postContent.user.username}">username</span></span>
                        <span class="text-textSec">·</span>
                        <span class="text-textSec text-sm" th:text="${#temporals.format(postContent.createdAt, 'MM월 dd일')}">Date</span>
                    </div>

                    <p class="text-white mt-0.5 text-[15px] whitespace-pre-wrap leading-snug" th:text="${postContent.content}"></p>

                    <div th:if="${postContent.mediaList != null and not #lists.isEmpty(postContent.mediaList)}" class="mt-3">
                        <img th:each="media : ${postContent.mediaList}" th:src="@{${media.fileUrl}}"
                             class="rounded-2xl border border-grayBorder w-full object-cover max-h-[500px]">
                    </div>

                    <div class="flex justify-between mt-3 text-textSec max-w-md pr-4 text-sm">
                        <div class="group flex items-center gap-1 hover:text-primary transition">
                            <i class="fa-regular fa-comment p-2 rounded-full group-hover:bg-primary/10"></i>
                            <span th:text="${#lists.size(postContent.replies)}">0</span>
                        </div>
                        <div class="group flex items-center gap-1 hover:text-retweet transition">
                            <i class="fa-solid fa-retweet p-2 rounded-full group-hover:bg-retweet/10"></i>
                            <span th:text="${item.retweetCount}">0</span>
                        </div>
                        <div class="group flex items-center gap-1 hover:text-like transition">
                            <i class="fa-regular fa-heart p-2 rounded-full group-hover:bg-like/10"></i>
                            <span th:text="${#lists.size(postContent.likes)}">0</span>
                        </div>
                        <div class="group flex items-center gap-1 hover:text-primary transition">
                            <i class="fa-solid fa-chart-simple p-2 rounded-full group-hover:bg-primary/10"></i>
                        </div>
                    </div>
                </div>
            </div>
        </div>

    </main>

    <div class="hidden lg:block w-[350px] pl-8 py-4 sticky top-0 h-screen">
        <div class="bg-[#16181C] rounded-2xl overflow-hidden pt-3 mb-4">
            <h3 class="font-extrabold text-xl px-4 mb-3">팔로우 추천</h3>
            <div class="hover:bg-white/5 transition px-4 py-3 cursor-pointer flex items-center gap-3">
                <div class="w-10 h-10 rounded-full bg-gray-600"></div>
                <div class="flex-1">
                    <div class="font-bold">멋진 개발자</div>
                    <div class="text-textSec text-sm">@cool_dev</div>
                </div>
                <button class="bg-white text-black px-4 py-1.5 rounded-full font-bold text-sm">팔로우</button>
            </div>
        </div>
    </div>
</div>

<div id="followModal" class="fixed inset-0 bg-white/10 backdrop-blur-sm hidden items-center justify-center z-50">
    <div class="bg-black w-full max-w-[600px] h-[600px] rounded-2xl flex flex-col relative overflow-hidden shadow-2xl border border-grayBorder">
        <div class="px-4 py-3 flex items-center justify-between border-b border-grayBorder">
            <h2 class="text-xl font-bold">팔로우 정보</h2>
            <button onclick="closeFollowModal()" class="w-8 h-8 rounded-full hover:bg-white/10 flex items-center justify-center transition">
                <i class="fa-solid fa-xmark text-xl"></i>
            </button>
        </div>
        <div class="flex border-b border-grayBorder">
            <button id="tab-followers" onclick="showFollowTab('followers')" class="flex-1 py-3 font-bold hover:bg-white/10 transition border-b-4 border-transparent text-textSec">팔로워</button>
            <button id="tab-following" onclick="showFollowTab('following')" class="flex-1 py-3 font-bold hover:bg-white/10 transition border-b-4 border-transparent text-textSec">팔로잉</button>
        </div>
        <div class="flex-1 overflow-y-auto p-0">
            <div id="followersList" class="hidden">
                <div th:if="${#lists.isEmpty(followers)}" class="p-8 text-center text-textSec"><p class="text-lg font-bold">아직 팔로워가 없습니다.</p></div>
                <a th:each="f : ${followers}" th:href="@{'/users/profile/' + ${f.follower.username}}" class="flex items-center gap-3 px-4 py-3 hover:bg-white/5 transition">
                    <img th:src="${f.follower.profileImageUrl ?: '/images/default_profile.png'}" class="w-10 h-10 rounded-full object-cover">
                    <div><div class="font-bold" th:text="${f.follower.username}"></div><div class="text-textSec text-sm">@<span th:text="${f.follower.username}"></span></div></div>
                </a>
            </div>
            <div id="followingList" class="hidden">
                <div th:if="${#lists.isEmpty(following)}" class="p-8 text-center text-textSec"><p class="text-lg font-bold">아직 팔로잉이 없습니다.</p></div>
                <a th:each="f : ${following}" th:href="@{'/users/profile/' + ${f.following.username}}" class="flex items-center gap-3 px-4 py-3 hover:bg-white/5 transition">
                    <img th:src="${f.following.profileImageUrl ?: '/images/default_profile.png'}" class="w-10 h-10 rounded-full object-cover">
                    <div><div class="font-bold" th:text="${f.following.username}"></div><div class="text-textSec text-sm">@<span th:text="${f.following.username}"></span></div></div>
                </a>
            </div>
        </div>
    </div>
</div>

<script>
    function openFollowModal(type) {
        document.getElementById('followModal').classList.remove('hidden');
        document.getElementById('followModal').classList.add('flex');
        showFollowTab(type);
    }
    function closeFollowModal() {
        document.getElementById('followModal').classList.add('hidden');
        document.getElementById('followModal').classList.remove('flex');
    }
    function showFollowTab(type) {
        const followersList = document.getElementById('followersList');
        const followingList = document.getElementById('followingList');
        const tabFollowers = document.getElementById('tab-followers');
        const tabFollowing = document.getElementById('tab-following');
        followersList.classList.add('hidden'); followingList.classList.add('hidden');
        tabFollowers.classList.remove('border-primary', 'text-white'); tabFollowing.classList.remove('border-primary', 'text-white');
        tabFollowers.classList.add('text-textSec'); tabFollowing.classList.add('text-textSec');
        if (type === 'followers') {
            followersList.classList.remove('hidden');
            tabFollowers.classList.add('border-primary', 'text-white');
            tabFollowers.classList.remove('text-textSec');
        } else {
            followingList.classList.remove('hidden');
            tabFollowing.classList.add('border-primary', 'text-white');
            tabFollowing.classList.remove('text-textSec');
        }
    }
</script>

</body>
</html>